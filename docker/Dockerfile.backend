FROM oven/bun:1

WORKDIR /usr/src/app

# Copy only package manifest files first for caching
COPY package.json bun.lockb ./

# Install dependencies
RUN bun install

# Copy full project files
COPY . .

# Ensure proper schema path is used in the script
# It's better to run prisma generate with explicit schema path
RUN bun run generate:db

# Build the backend
RUN bunx turbo build --filter=backend...

EXPOSE 8080

# Start the backend application
CMD ["bun", "start:backend"]
